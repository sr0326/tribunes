!function(csdn,udf){var $=window.jQuery||{},isJq=udf,doc=window.document,oHead=doc.head,$selector=udf,isMobileDevice,dataTag="data-bind-sms",dataTagF="[data-bind-sms=true]",docDom=udf,preTag="sms",styleTag=preTag+"-box",markTag=preTag+"-mark",doMainName="//passport.csdn.net",version="1.0.0",reqUrl={submitUrl:doMainName+"/v1/api/riskControl/checkVerifyCode",getValidateCodeUrl:doMainName+"/v1/api/riskControl/sendVerifyCode",getUserMobileUrl:doMainName+"/v1/api/riskControl/getUserMobile"},getDevice=function(){return isMobileDevice=/mobile|micromessenger|ios|tablet|Android tablet|Android phone|Android|webOS|NokiaN9|iPhone|iPod|BlackBerry|BlackBerry phone|BlackBerry tablet|window phone|window tablet|firefox os|firefox os phone|firefox os tablet|meeGo|Television|IEMobile|Opera Mini/i.test(navigator.userAgent.toLowerCase())};csdn.smsBox=csdn.smsBox?csdn.smsBox:{},$===window.jQuery?($selectorAll=function(e){var n=[];return $(e).each(function(e,t){n.push(t)}),n},$selector=function(e){return $(e).get(0)},isJq=!0):($selectorAll=function(e){return document.querySelectorAll(e)},$selector=function(e){return document.querySelector(e)}),$.SMS=$.SMS||{},$.SMS.isInit=!0,csdn.smsBox.scope=$.SMS;var createJquery=function(){var e=doc.createElement("script");e.type="text/javascript",e.src="//csdnimg.cn/public/common/libs/jquery/jquery-1.9.1.min.js",oHead.appendChild(e),e.onload=function(){$._$=window.jQuery}},getCookie=function(r){var s=document.cookie;return s&&function(){for(var e,t={},n=0,o=(s=s.split("; ")).length;n<o&&!(0<(e=s[n].split("=")).length&&(e[0]===r&&(t.key=e[0],t.value=e[1],t.status=!0),"key"in t));n++);return"key"in t&&t}()},setCookie=function(e,t,n,o,r){var s,a=e+"="+t+";";r&&((s=new Date).setTime(s.getTime()+r),a=a+"expires="+s.toGMTString()+";"),n&&(a=a+"domain="+n+";"),o&&(a=a+"path="+o+";"),document.cookie=a},clearCookie=function(e,t,n){var o,r,s=getCookie(e);s&&!0===s.status&&(o=s.key+"="+s.value+";",(r=new Date).setTime(r.getTime()-1e3),o=o+"expires="+r.toGMTString()+";",t&&(o=o+"domain="+t+";"),n&&(o=o+"path="+n+";"),document.cookie=o)},renderLinkCss=function(){var e=doc.createElement("link");e.rel="stylesheet",e.href="//g.csdnimg.cn/user-sms/1.0.0/user-sms-verification.css?v="+version,oHead.appendChild(e)},renderCss=function(){var e=oHead.firstElementChild||oHead.firstChild,t="."+styleTag+"{position: fixed;display: none;left: 50%;top: 50%;z-index: 10000;-webkit-transform: translate(-50%, -50%);-ms-transform: translate(-50%, -50%);-o-transform: translate(-50%, -50%);-moz-transform: translate(-50%, -50%);transform: translate(-50%, -50%);background-color: #fff;}",n="."+markTag+"{position: fixed;top: 0;left: 0;z-index: 9999;background-color: rgba(0, 0, 0, 0.5);width: 100%;height: 100%;display: none;}",o=document.createElement("style");o.innerText=t+n,oHead.insertBefore(o,e),renderLinkCss()},tpl=function(e){return'<span class="title">验证安全手机</span><div class="sms-content hide"><p class="sms-text sms-mobile" id="sms-mobile">验证码将发送到手机 &nbsp;<i>'+(e||"")+'</i></p><p class="sms-info">如果长时间未收到验证码，请检查是否将运营商拉黑</p><div class="sms-validate"><label>填写验证码：</label><span class="validate-wrap"><input type="text" class="validate-input" id="validate-input" placeholder="6位数字验证码"/><button class="validate-code" id="validate-code">获取验证码</button></span><span class="error-text hide" id="error-text"></span></div><div class="sms-btns"><button class="sms-reset" id="sms-reset">取消</button><button class="sms-confirm" id="sms-confirm">确定</button></div></div><div class="sms-error hide"></div>'},insertDom=function(e){$.SMS.docDom&&(doc.body.appendChild($.SMS.oMark),doc.body.appendChild($.SMS.docDom),$.SMS.appendBox.isCreate=!0)},smsBox=function(e){var t,n,o=e.domain,r=(e.from,e.append),s=e.isClosedBtn,a=document.createElement("div");return a.className=markTag,doc.domain=o||"csdn.net",t=document.createDocumentFragment(),(n=document.createElement("div")).id=r.replace(/[#\.]/,""),n.className=styleTag,getDevice()?n.className=n.className+" sms-box-mobile":n.className=n.className+" sms-box-pc",$.SMS.appendBox=n,$.SMS.markDom=a,$.SMS.appendBox.innerHTML=tpl(),$.SMS.errorText=$.SMS.appendBox.querySelector(".error-text")||doc.getElementById("error-text"),$.SMS.errorDom=$.SMS.appendBox.querySelector(".sms-error")||$.SMS.appendBox.children[2],$.SMS.strDom=$.SMS.appendBox.querySelector(".sms-mobile")||$.SMS.appendBox.children[1]&&($.SMS.appendBox.children[1].firstElementChild||$.SMS.appendBox.children[1].firstChild),$.SMS.resetBtn=$.SMS.appendBox.querySelector(".sms-reset")||doc.getElementById("sms-reset"),$.SMS.confirmBtn=$.SMS.appendBox.querySelector(".sms-confirm")||doc.getElementById("sms-confirm"),$.SMS.validateInput=$.SMS.appendBox.querySelector(".validate-input")||doc.getElementById("validate-input"),$.SMS.validateCode=$.SMS.appendBox.querySelector(".validate-code")||doc.getElementById("validate-code"),s&&(cssStyle="display: inline-block; color: #E0E0E0; font-size: 20px; cursor: pointer; position:absolute; top:4%; right:5%;-moz-user-select:none; -webkit-user-select:none; user-select:none;",closeBtn=document.createElement("span"),closeBtn.style=cssStyle,closeBtn.className=preTag+"-close",closeBtn.innerHTML="&times",n.appendChild(closeBtn),$.SMS.closeBtn=closeBtn),t&&(t.appendChild(n),$.SMS.oMark=a,$.SMS.docDom=t),!0},sms=function(e){var t={domain:(e=e||{}).domain||"csdn.net",append:e.append||"#sms-box",isClosedBtn:null==e.isClosedBtn||!!e.isClosedBtn,from:e.from,initRun:e.initRun||null,beforeInit:e.beforeInit||null,afterInit:e.afterInit||null,before:e.before||null,after:e.after||null,finished:e.finished||null,callback:e.callback||null,toSuccess:e.toSuccess||null,toFail:e.toFail||null,toError:e.toError||null};return $.SMS.options=t,$.SMS.runStatus=!0,t.initRun&&($.SMS.runStatus=t.initRun()),$.SMS.runStatus&&($.SMS.runStatus=smsBox(t)),$.SMS.runStatus&&!$.SMS.isInit&&createDom(),csdn.smsBox},run=function(e){return $.SMS.runStatus=$.SMS.options[e]?$.SMS.options[e]():$.SMS.runStatus,$.SMS.runStatus},addEvent=function(e,t,n){window.addEventListener?e.addEventListener(t,n,!1):e.attachEvent("on"+t,n)},delEvent=function(e,t,n){window.removeEventListener?e.removeEventListener(t,n,!1):e.detachEvent("on"+t,n)},renderLayer=function(e,t){var n;return n="all"===e?"none":"block","start"===e&&(n="block"),$.SMS.appendBox&&($.SMS.markDom.style.display=n,$.SMS.appendBox.style.display=n,$.SMS.appendBox.status="block"===n||!($.SMS.runStatus=!0)),$.SMS.appendBox.status&&t&&t(),$.SMS},setClass=function(e){var t=e.elem;if(!t)return!1;e.isShow?(-1<t.className.indexOf("hide")&&(t.className=t.className.replace(/hide/gi,"").replace(/^\s*|\s*$/g,"")),-1===t.className.indexOf("show")&&(t.className=t.className+" show")):(-1<t.className.indexOf("show")&&(t.className=t.className.replace(/show/gi,"").replace(/^\s*|\s*$/g,"")),-1===t.className.indexOf("hide")&&(t.className=t.className+" hide"))},reset=function(){setClass({elem:$.SMS.errorText,isShow:!1}),$.SMS.validateInput.value="",$.SMS.validateCode.onclick=$.SMS.confirmBtn.onclick=null,clearTimeout($.SMS.validateCode.time),$.SMS.validateCode.time=null,$.SMS.validateCode.innerHTML="获取验证码",$.SMS.validateCode.removeAttribute("style"),$.SMS.validateCode.removeAttribute("disabled")},smsDocClose=function(){var e=function(e){var t=window.event||e;if($.SMS.appendBox.status)return renderLayer("all"),reset(),t.cancelBubble?t.cancelBubble=!0:t.stopPropagation(),!1};$.SMS.oMark&&!$.SMS.oMark.isClick&&(delEvent($.SMS.oMark,"click",e),addEvent($.SMS.oMark,"click",e),$.SMS.oMark.isClick=!0),$.SMS.closeBtn&&$.SMS.oMark.isClick&&!$.SMS.closeBtn.isCloseClick&&(delEvent($.SMS.closeBtn,"click",e),addEvent($.SMS.closeBtn,"click",e),$.SMS.resetBtn&&(delEvent($.SMS.resetBtn,"click",e),addEvent($.SMS.resetBtn,"click",e)),$.SMS.closeBtn.isCloseClick=!0)},createDom=function(){!$.SMS.appendBox.isCreate&&insertDom(),run("before")&&renderLayer(udf,function(){run("after")}),smsDocClose()},smsBind=function(){$.SMS.smsBtn=$selectorAll(dataTagF);var e,t,n=function(e){var t=window.event||e,n="true"===this.getAttribute(dataTag);if(!$.SMS.runStatus&&n)return console.error("开启smsBox失败!"),!1;!0===n&&(createDom(),t.cancelBubble?t.cancelBubble=!0:t.stopPropagation(),t.returnValue?t.returnValue=!1:t.preventDefault())},o=0;if(!$.SMS.smsBtn||$.SMS.smsBtn.length<=0)return!1;for(;$.SMS.smsBtn[o];)e=o,void 0,t=$.SMS.smsBtn[e],addEvent(t,"click",n),o++},render=function(){renderCss(),isJq?$._$=window.jQuery:createJquery()};csdn.smsBox.sms=function(e){smsAutoStart(e)};var smsAutoStart=function(options){var count=function(){var e=5,t=function(){$.SMS.validateCode.innerHTML=e,$.SMS.validateCode.time=setTimeout(function(){if(e--,($.SMS.validateCode.innerHTML=e)<=-1)return e=60,clearTimeout($.SMS.validateCode.time),$.SMS.validateCode.time.time=null,$.SMS.validateCode.innerHTML="获取验证码",$.SMS.validateCode.removeAttribute("style"),$.SMS.validateCode.removeAttribute("disabled"),!1;t()},1e3)};t()},getCodeAjax=function(){$._$.ajax({url:reqUrl.getValidateCodeUrl,type:"post",xhrFields:{withCredentials:!0},dataType:"json",success:function(e){e.status&&(count(),setClass({elem:$.SMS.errorText,isShow:!0}),$.SMS.errorText.innerHTML="验证码已发送！",setTimeout(function(){setClass({elem:$.SMS.errorText,isShow:!1})},5e3))},error:function(error){var errData;error&&console.error(error),setClass({elem:$.SMS.errorText,isShow:!0}),error.responseText?(errData=eval("("+error.responseText+")"),$.SMS.options.toFail&&$.SMS.options.toFail(error),$.SMS.errorText.innerHTML=errData.message||"获取验证失败"):($.SMS.options.toError&&$.SMS.options.toError(error),$.SMS.errorText.innerHTML=errData.message||"服务器异常！")}})},checkValue=function(){return $.SMS.validateInput.value&&($.SMS.validateInput.value=$.SMS.validateInput.value.replace(/^\s*|\s*$/g,"")),{status:/^\d{6}$/g.test($.SMS.validateInput.value)}},validateInputFocus=function(){$.SMS.validateInput.onfocus=function(){-1<$.SMS.errorText.className.indexOf("show")&&setClass({elem:$.SMS.errorText,isShow:!1})}},toStartGetCode=function(e){if(!e.btn)return!1;e.btn.onclick=function(e){var t=window.event||e;$.SMS.validateCode.style.cursor="default",$.SMS.validateCode.setAttribute("disabled",!0),getCodeAjax(),t.cancelBubble?t.cancelBubble=!0:t.stopPropagation(),t.returnValue?t.returnValue=!1:t.preventDefault()}},toValidate=function(params){params.btn&&(params.btn.onclick=function(event){var e=window.event||event,status=checkValue();status.status?function(){$._$.ajax({url:reqUrl.submitUrl,type:"post",xhrFields:{withCredentials:!0},data:JSON.stringify({verifyCode:$.SMS.validateInput.value}),contentType:"application/json;charset=utf-8",dataType:"json",success:function(e){e.status&&(setClass({elem:$.SMS.errorText,isShow:!1}),$.SMS.options.toSuccess&&$.SMS.options.toSuccess(e))},error:function(error){var errData;error&&console.error(error),setClass({elem:$.SMS.errorText,isShow:!0}),error.responseText?(errData=eval("("+error.responseText+")"),$.SMS.options.toFail&&$.SMS.options.toFail(error),$.SMS.errorText.innerHTML=errData.message||"验证失败"):($.SMS.options.toError&&$.SMS.options.toError(error),$.SMS.errorText.innerHTML=errData.message||"服务器异常！")}})}():(setClass({elem:$.SMS.errorText,isShow:!0}),$.SMS.errorText.innerHTML="验证码格式错误"),e.cancelBubble?e.cancelBubble=!0:e.stopPropagation(),e.returnValue?e.returnValue=!1:e.preventDefault()})},getUserMobile=function(){$._$.ajax({url:reqUrl.getUserMobileUrl,type:"post",xhrFields:{withCredentials:!0},dataType:"json",success:function(e){var t=$.SMS.strDom.getElementsByTagName("i")[0];e.status&&(setClass({elem:$.SMS.strDom.parentNode,isShow:!0}),e.data&&e.data.mobile&&(t.innerHTML=e.data.mobile))},error:function(error){var errData;setClass({elem:$.SMS.strDom.parentNode,isShow:!1}),error.responseText?(errData=eval("("+error.responseText+")"),$.SMS.options.toFail&&$.SMS.options.toFail(error),$.SMS.errorDom.innerHTML=errData.message||"获取用户手机号失败！，请稍后尝试！"):($.SMS.options.toError&&$.SMS.options.toError(error),$.SMS.errorDom.innerHTML="服务器异常！"),$.SMS.errorDom&&setClass({elem:$.SMS.errorDom,isShow:!0})}})},beforeRun=function(){getUserMobile()},afterRun=function(){$.SMS&&(validateInputFocus(),toStartGetCode({btn:$.SMS.validateCode}),toValidate({btn:$.SMS.confirmBtn}))},defaultRun={domain:"csdn.net",append:"#smsbox",from:window.location.href,initRun:function(){return console.log("initRun finished"),!0},before:function(){return console.log("before"),beforeRun(),!0},after:function(){return console.log("after"),afterRun(),!0}};if(csdn.smsBox.defineOptions)for(var attr in csdn.smsBox.defineOptions)defaultRun[attr]=csdn.smsBox.defineOptions[attr];if(options&&"object"==typeof options)for(var attr in options)defaultRun[attr]=options[attr];sms(defaultRun)},smsReady=function(){if(render(),$.SMS.isInit=!1,csdn.smsBox.defineOptions&&null!=csdn.smsBox.defineOptions.isInit&&($.SMS.isInit=csdn.smsBox.defineOptions.isInit),!$.SMS.isInit)return!1;smsBind(),$.SMS.isInit&&smsAutoStart()},loadFn;csdn.smsBox.close=function(){return $.SMS.appendBox.status&&renderLayer("all"),csdn.smsBox},csdn.smsBox.show=function(e){return smsAutoStart(e),csdn.smsBox};var IEContentLoaded=function(e){var t=!1,n=function(){t||(t=!0,e&&e())},o=function(){try{doc.documentElement.doScroll("left")}catch(e){return void setTimeout(o,50)}n()};o(),doc.onreadystatechange=function(){"complete"===doc.readyState&&(doc.onreadystatechange=null,n())}},loadReady=function(e){document.addEventListener?~["complete","loaded","interactive"].indexOf(document.readyState)?setTimeout(function(){e&&e()},0):(loadFn=function(){document.removeEventListener("DOMContentLoaded",loadFn,!1),e()},document.addEventListener("DOMContentLoaded",loadFn,!1)):document.attachEvent&&IEContentLoaded(e)};_ready=function(){isJq&&$(function(){smsReady()})||loadReady(smsReady)},_ready()}(window.csdn=window.csdn||{},void 0);