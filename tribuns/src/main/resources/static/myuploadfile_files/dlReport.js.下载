define(["apps/_verificaUser","apps/show"],function(o,n){return{init:function(){var r=$("#download_report"),e=$("#btn_submit"),t=$(".dl_download").attr("data-id");function l(r){var e=$("#report_tips_error");e.show(),e.html(r)}function c(){var r=$("#report_tips_error");r.hide(),r.html(" ")}r.on("click",function(r){o._verificaUser()&&(reportUrl="/index.php/report/before_do_report/"+t,$.ajax({type:"get",url:reportUrl,async:!1,dataType:"jsonp",jsonpcallback:"jsonpcallback",success:function(r){0==r.succ?(n.show("#download"),$("#download .download_tips").html(r.msg),$("#download .dl_download_btn").hide()):1==r.succ?n.show("#dlReport"):2==r.succ?n.show("#myself"):3==r.succ&&n.show("#nodownload")},error:function(r){console.log(r)}})),r.stopPropagation()}),$("#report_type").on("change",function(){"侵犯版权资源 （侵犯公司或个人版权）"==$(this).val()?($(".report_wrap").show(),$(".report_reason").hide()):($(".report_wrap").hide(),$(".report_reason").show())}),submit_report=function(){c();var r=$("#report_type").val(),e=$("#report_description").val(),t=$("#report_name").val(),o=$("#report_call").val(),n=$("#report_file").val(),a=/^1[34578]\d{9}$/.test(o)||/([a-z0-9]*[-_.]?[a-z0-9]+)*@([a-z0-9]*[-_]?[a-z0-9]+)+[.][a-z]{2,3}([.][a-z]{2})?/i.test(o),i=/^([\u4e00-\u9fa5]+|([a-zA-Z]+\s?)+)$/.test(t),s=0;if("请选择类型"==r)return s+=1,l("请选择类型！"),!1;if($(".report_wrap").is(":visible")){if(""==t)return s+=1,l("投诉人姓名不能为空！"),!1;if(!i)return s+=1,l("投诉人姓名格式不正确！"),!1;if(""==o)return s+=1,l("投诉人联系方式不能为空！"),!1;if(!a)return s+=1,l("投诉人联系方式格式不正确！"),!1;if(""==n)return s+=1,l("请选择版权证明！"),!1}else if(""==e)return s+=1,l("描述不能为空！"),!1;0==s&&(xhr=$("#reportform").ajaxSubmit({dataType:"json",beforeSubmit:function(r,e,t){},error:function(r,e,t){alert(t)},success:function(r){return-1==r.succ&&alert("请先登录"),1==r.succ?(alert("举报成功"),!0):(2==r.succ?alert("该资源已被举报过，正在审核中"):alert(r.msg),!1)}}),$(".dl_popup,#dlMask").hide())},$("#report_file").on("change",function(){""!=this.value&&function(r){var e=0;if(!/msie/i.test(navigator.userAgent)||window.opera||r.files)e=r.files[0].size;else try{var t=r.value,o=new ActiveXObject("Scripting.FileSystemObject"),n=o.GetFile(t);e=n.Size}catch(r){console.log(r.message),e="error"}var a=e/1024;if(3072<a)return l("附件不能大于3M"),r.value="";c();var i=r.value,s=i.substring(i.lastIndexOf(".")+1).toLowerCase();if("jpg,jpeg,gif,png".indexOf(s))return l("请选择正确的图片格式上传！"),r.value="";c()}(this)}),e.on("click",function(r){submit_report(),r.stopPropagation()})}}});