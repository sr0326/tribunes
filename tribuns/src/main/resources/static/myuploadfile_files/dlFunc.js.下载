define(["apps/_verificaUser","apps/show"],function(f,l){return{init:function(){var t=$("#favorite"),o=$("#download_top").attr("data-id"),e=$("#dl_lock .sec_pop_t"),r=$("#favorite em i"),n=parseInt(r.text());t.on("click",function(a){var s=$(this);f._verificaUser()&&$.ajax({type:"post",url:"/index.php/favorite/do_favorite",data:{sourceId:o},async:!1,success:function(a){0==a.succ?(l.show("#dl_lock"),e.html('收藏失败！点击&nbsp;<a href="/my/favs" target="_blank">我的收藏</a>&nbsp;查看收藏的全部资源')):-1==a.succ?(l.show("#dl_lock"),e.html('已收藏！点击&nbsp;<a href="/my/favs" target="_blank">我的收藏</a>&nbsp;查看收藏的全部资源'),t.find(".fa").addClass("fa-star").removeClass("fa-star-o"),s.addClass("favoRed")):-3==a.succ?(l.show("#dl_lock"),e.html("refer地址错误！")):(l.show("#dl_lock"),e.html('收藏成功！点击&nbsp;<a href="/my/favs" target="_blank">我的收藏</a>&nbsp;查看收藏的全部资源'),r.text(n+1),t.find(".fa").addClass("fa-star").removeClass("fa-star-o"),s.addClass("favoRed"))},error:function(a){console.log(a)}}),a.stopPropagation()})}}});